<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker's Playground</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Meta SEO -->
    <meta name="title" content="hackersplayground" />
    <meta name="description"
        content="hackersplayground is a cyber awareness game to train common peoples about cyber attacks" />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="hackersplayground" />

    <!-- Social media share -->
    <meta property="og:description"
        content="Hackers Playground is a cyber awareness game to train common peoples about cyber attacks" />
    <meta property="og:type" content="Education" />
    <link rel="stylesheet" href="/css/hackersplayground.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/award/badges.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top" style="background-color: #001F3F; height: 70px; z-index: 1000;">
        <div class="container-fluid">
            <!-- Logo -->
            <a class="navbar-brand" href="/index.html">
                <img src="/images/hackerlogo.png" alt="Hackers Playground Logo" style="height: 50px;">
            </a>

            <!-- Toggler for mobile view -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar content -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- Left side links -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5" href="/learn.html" target="_blank">Learn</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5" href="/play/play.html" target="_blank">Play</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5" href="/award/badges.html">Compete</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5" href="/about.html" target="_blank">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5" href="/contact.html" target="_blank">Contact</a>
                    </li>
                </ul>

                <!-- Right side: Search + Auth buttons -->
                <form class="d-flex align-items-center" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <a href="/signin.html" target="_blank" class="btn btn-outline-success me-2" id="loginBtn">Login</a>
                    <a href="/signup.html" target="_blank" class="btn btn-outline-success" id="signupBtn">Sign Up</a>
                </form>
            </div>
        </div>
    </nav>


    <div class="container">
        <div id="highScores" class="flex-center flex-column">
            <h1 id="finalScore">Leaderboard</h1>
            <img class="leaderboard" src="../images/award.png">
            <div>
                <h1 id="currentLevel"></h1>
            </div>
            <p class="awardsText">Awards :</p>
            <div id="awards">
                <div id="awardsImages"></div>
            </div>
            <li class="link techsupport">
                <a href="/index.html">
                    <h4 class="banner"><span>HOME</span></h4>
                </a>
            </li>
        </div>
    </div>

    <!-- Confetti library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <!-- Leaderboard + Firebase Auth + Firestore -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBt7je8Ga9fKVJ7Pu2Ok8HvbFaLV5Qe1ts",
            authDomain: "hackersplayground-ca1a1.firebaseapp.com",
            projectId: "hackersplayground-ca1a1",
            storageBucket: "hackersplayground-ca1a1.appspot.com",
            messagingSenderId: "597874916220",
            appId: "1:597874916220:web:85ad84575aac58ce4c82f9",
            measurementId: "G-PSC705VYNS"
        };

        // Firebase init
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Navbar user management
        window.addEventListener("DOMContentLoaded", () => {
            const navForm = document.querySelector(".navbar .d-flex");

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const userName = user.displayName?.trim() || user.email.split('@')[0];

                    navForm.innerHTML = `
          <span class="text-white me-3 fs-6 fw-bold">Welcome, ${userName}</span>
          <button id="logoutBtn" class="btn btn-outline-danger">Logout</button>
        `;

                    document.getElementById("logoutBtn").addEventListener("click", () => {
                        signOut(auth).then(() => {
                            window.location.reload();
                        }).catch((error) => {
                            alert("Logout error: " + error.message);
                        });
                    });

                } else {
                    navForm.innerHTML = `
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <a href="/signin.html" target="_blank" class="btn btn-outline-success mybutton1" id="mybtn" style="margin-right: 10px;">Login</a>
          <a href="/signup.html" target="_blank" class="btn btn-outline-success mybutton2" id="mybtn">Sign Up</a>
        `;
                }
            });
        });

        // Leaderboard rendering
        async function renderLeaderboard() {
            const leaderboardContainer = document.createElement("div");
            leaderboardContainer.style.marginTop = "30px";
            leaderboardContainer.style.width = "100%";
            leaderboardContainer.style.maxWidth = "600px";
            leaderboardContainer.style.textAlign = "left";
            leaderboardContainer.style.background = "#fff";
            leaderboardContainer.style.borderRadius = "10px";
            leaderboardContainer.style.padding = "20px";
            leaderboardContainer.style.boxShadow = "0 0 20px rgba(0,0,0,0.2)";
            document.getElementById("highScores").appendChild(leaderboardContainer);

            const usersRef = collection(db, "users");
            const snapshot = await getDocs(usersRef);
            const leaderboard = [];

            snapshot.forEach(doc => {
                const data = doc.data();
                const name = data.name || "Unknown";
                const scores = data.scores || {};
                const total = Object.values(scores).reduce((sum, val) => sum + val, 0);
                leaderboard.push({ name, total, uid: doc.id });
            });

            leaderboard.sort((a, b) => b.total - a.total);

            onAuthStateChanged(auth, (user) => {
                if (!user) {
                    leaderboardContainer.innerHTML = "<p>Please login to see your leaderboard rank.</p>";
                    return;
                }

                const currentUserId = user.uid;
                const currentUserIndex = leaderboard.findIndex(entry => entry.uid === currentUserId);
                const currentUser = leaderboard[currentUserIndex];

                // üéâ Confetti if top 3
                if (currentUserIndex === 0 || currentUserIndex === 1 || currentUserIndex === 2) {
                    confetti({
                        particleCount: 200,
                        spread: 100,
                        origin: { y: 0.6 }
                    });
                }

                let html = `
        <h3 style="font-family: 'Roboto Condensed'; font-size: 20px; color: #007BFF;">Welcome, <strong>${currentUser?.name || user.email}</strong></h3>
        <p style="font-size: 16px; margin-bottom: 20px;">üî¢ Your Total Score: <strong>${currentUser?.total || 0}</strong><br>üèÖ Your Rank: <strong>#${currentUserIndex + 1}</strong></p>
        <h4 style="font-family: 'Roboto Condensed'; font-size: 20px;">Leaderboard</h4>
        <ol>
      `;

                leaderboard.forEach((user, i) => {
                    let medal = '';
                    if (i === 0) medal = 'ü•á';
                    else if (i === 1) medal = 'ü•à';
                    else if (i === 2) medal = 'ü•â';
                    else medal = 'üîπ';

                    html += `<li style="margin: 8px 0; font-size: 17px;">${medal} <strong>${user.name}</strong> ‚Äî ${user.total} pts</li>`;
                });

                html += `</ol>`;
                leaderboardContainer.innerHTML = html;
            });
        }

        renderLeaderboard();
    </script>


</body>

</html>